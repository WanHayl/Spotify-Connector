import spotipy
from spotipy.oauth2 import SpotifyOAuth
from spotipy import Spotify
import pandas as pd
import os

#Rock List
music = pd.read_excel(r'c:\Users\dreik\Desktop\Rock_Music_Through_Decades_1.xlsx')

music_df = music[['Band','Song']]


#global values
clientid = '4612c08179434a02b00336f6772773a2'
clientsecret = '85dd986003cc4afd91bcce00294b1c2c'
redirecturi = 'http://localhost:7777/callback'


#sample data for testing
data = {
    'Band': ['3 Doors Down','Aerosmith','Alice in Chains','Asking Alexandria','Breaking Benjamin'],
    'Song': ['Kryptonite','Falling in Love Is Hard on the Knees','Your Decision','Alone Again','I Will Not Bow']
}

def retrieve_auth(clientid, clientsecret, redirecturi):
    sp_oauth = SpotifyOAuth(client_id=clientid, client_secret=clientsecret, redirect_uri=redirecturi)
    access_token = sp_oauth.get_cached_token()
    return spotipy.Spotify(auth_manager=sp_oauth)

sp = retrieve_auth(clientid, clientsecret, redirecturi)



def search_song(song_name,artist_name,spotify_client):
    query = f'track:{song_name} artist:{artist_name}'
    result = spotify_client.search(q=query,limit=1,type='track')
    if result['tracks']['items']:
        return result['tracks']['items'][0]
    else:
        return None


all_songs_info = []

for band, song in zip(data['Band'],data['Song']):
    song_info = search_song(song,band,sp)
    songs = { 'Song': song_info['name'],
                'Band': song_info['artists'][0]['name'],
                'Album': song_info['album']['name'],
                'Track ID': song_info['id'],
                'Preview URL' : song_info['preview_url']
        
    }
    all_songs_info.append(songs)

songs_df = pd.DataFrame(all_songs_info)
print(songs_df)

desktop_path = os.path.join(os.path.expanduser("~"),"Desktop")
output_filename = "Songs Information.csv"
output_path = os.path.join(desktop_path,output_filename)

songs_df.to_csv(output_path, index=False)
